<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project</title>
    <script
      src="https://code.jquery.com/jquery-3.6.4.js"
      integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E="
      crossorigin="anonymous"
    ></script>
    <style>
      #margintop,#marginbottom,#marginleft,#marginright {
        display: none;
      }
      #margintop {
        position: absolute;
        z-index: 200;
        left: -444px;
        top: -282px;
        width: 2597px;
      }
      #marginbottom {
        position: absolute;
        z-index: 200;
        width: 2597px;
        top: 602px;
        left: -445px;
      }
      #marginleft {
        position: absolute;
        z-index: 200;
        height: 402px;
        top: 200px;
        left: -449px;
      }
      #marginright {
        position: absolute;
        z-index: 200;
        height: 402px;
        top: 200px;
        left: 1202px;
      }
      #container {
        position: absolute;
        width: 800px;
        height: 400px;
        left: 400px;
        top: 200px;
        border: 1px black solid;
      }
      #gamestartdisplay {
        z-index: 300;
        position: absolute;
        width: 800px;
        height: 400px;
      }
      #gamestartlogo {
        z-index: 300;
        position: absolute;
        width: 380px;
        left: 430px;
        top: 90px;
      }
      #gamestartbutton {
        z-index: 300;
        position: absolute;
        left: 530px;
        width: 200px;
        top: 180px;
      }
      #gamestartclick {
        z-index: 300;
        position: absolute;
        width: 40px;
        height: 50px;
        left: 695px;
        top: 285px;
      }
      #background1 {
        background: url("../game/images/background.png");
      }
      #background2 {
        background: url("../game/images/background.png");
        left: 800px;
      }
      .sliding-background {
        z-index: -100;
        position: absolute;
        width: 800px;
        height: 400px;
        opacity: 0.75;
        animation: slide 2s linear infinite;
        animation-fill-mode: forwards;
      }
      @keyframes slide {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(-100%, 0);
        }
      }
      #sonic {
        z-index: 10;
        position: absolute;
        left: -100px;
        bottom: 40px;
        width: 100px;
        height: 100px;
      }
      #metalslug {
        z-index: 10;
        position: absolute;
        transform: scaleX(-1);
        width: 180px;
        height: 200px;
        bottom: 30px;
        right: -180px;
      }
      #tank {
        z-index: 5;
        position: absolute;
        transform: scaleX(-1);
        width: 130px;
        left: -130px;
        bottom: 30px;
      }
      #attack {
        z-index: 5;
        position: absolute;
        display: none;
        width: 50px;
        left: 40px;
        bottom: 92px;
      }
      #dragonball {
        z-index: 10;
        position: absolute;
        left: -300px;
        bottom: 40px;
        width: 160px;
        height: 180px;
      }
      #dragonballeffect {
        z-index: 50;
        position: absolute;
        display: none;
        width: 800px;
        height: 400px;
      }
      #bullet {
        z-index: 5;
        position: absolute;
        z-index: 3;
        width: 40px;
        height: 40px;
        right: 50px;
        bottom: 60px;
        display: none;
      }
      #ring {
        z-index: 5;
        position: absolute;
        width: 70px;
        right: -60px;
        bottom: 130px;
      }
      #bigring {
        z-index: 5;
        position: absolute;
        width: 250px;
        right: -200px;
        bottom: 130px;
      }
      #scoreboardled {
        position: absolute;
        width: 200px;
        height: 100px;
        top: -10px;
        right: 30px;
      }
      #score {
        position: absolute;
        background-color: black;
        color: red;
        font-size: 36px;
        text-align: end;
        padding-right: 20px;
        width: 140px;
        height: 53px;
        right: 50px;
        top: 24px;
        border-radius: 10%;
      }
      #score2 {
        z-index: 100;
        position: absolute;
        display: none;
        color: white;
        font-size: 40px;
        text-align: center;
        width: 100%;
        top: 230px;
      }
      #score3 {
        z-index: 100;
        position: absolute;
        display: none;
        color: white;
        font-size: 30px;
        text-align: center;
        width: 100%;
        top: 190px;
      }
      #gameoverbackground {
        z-index: 99;
        position: absolute;
        display: none;
        width: 800px;
        height: 400px;
        background-color: black;
        opacity: 0.7;
      }
      #gameovertext {
        z-index: 100;
        position: absolute;
        display: none;
        width: 600px;
        left: 100px;
      }
      #newgame {
        z-index: 100;
        position: absolute;
        display: none;
        width: 200px;
        left: 300px;
        top: 300px;
      }
      #newgameclick {
        z-index: 101;
        position: absolute;
        display: none;
        width: 40px;
        height: 50px;
        left: 470px;
        bottom: 30px;
      }
      #inforing {
        position: absolute;
        width: 70px;
        top: 500px;
      }
      #infobullet {
        position: absolute;
        width: 50px;
        top: 500px;
      }
    </style>

    <script>

      let gokuchance = 1;
      let score = 0;

      //
      function gameStart() {
        setKeyboardEvent();
        sonicMoveRight();
        setTimeout(metalslugMoveLeft, 2000);
        setTimeout(bulletStart, 7000);
        setTimeout(ringStart, 8000);
        setTimeout(bigringStart, 12000);
        tankMoveRight();
        CollidingResult();
      }

      //
      function sonicMoveRight() {
        $("#sonic").animate({ left: "+=200px" }, 1500);
      }

      //
      function metalslugMoveLeft() {
        $("#metalslug").animate({ left: "-=200px" }, 1500);
        $("#metalslug").animate({ left: "+=30px" }, 500);
        setTimeout(changeChar, 2200);
      }

      //
      function tankMoveRight() {
        $("#tank").animate({left: "+=110px"},1500);
      }

      //
      function attackMoveRight() {
        isAttack = true;
        $("#attack").show();
        $("#attack").animate({ left: "800px" }, 800, "linear" ,function () {
          $("#attack").css("left", "40px");
          $("#attack").hide();
          isAttack = false;
        });
      }

      //
      function dragonballMoveRight() {
        $("#dragonballeffect").hide();
        $("#dragonball").animate({ left: "+=500px" }, 1500);
        setTimeout(() => {
          $("#dragonball").animate({ left: "+=440px" }, 1500);
        }, 8000);
        setTimeout(() => {
          $("#dragonball").hide();
        }, 9000);
      }

      //
      function changeChar() {
        $("#metalslug").attr("src", "../game/images/metalslug2.gif");
        $("#metalslug").css("width","120px");
        $("#metalslug").css("height","130px");
        $("#metalslug")
          .animate({ bottom: "+=100px" })
          .animate({ bottom: "-=100px" });
        setTimeout(() => {
          $("#metalslug").attr("src", "../game/images/metalslug3.gif");
        }, 2000);
        setTimeout(() => {
          $("#bullet").show();
        }, 2100);
      }

      //
      function bulletStart() {
        const bulletSpeed = getRandomNumber(1000, 2000);
        $("#bullet").animate({ right: "850px" }, bulletSpeed, "linear", function () {
          score += 100;
          updateScore(score);
          $("#bullet").css("right", "90px");
          bulletStart();
        });
      }

      //
      function ringStart(){
        $("#ring").show();
        const ringSpeed = getRandomNumber(2000,4000);
        $("#ring").animate({ right: "850px" }, ringSpeed, "linear", function () {
          $("#ring").css("right", "-60px");
          ringStart();
        });
      }

      //
      function bigringStart(){
        $("#bigring").show();
        const bigringSpeed = getRandomNumber(1000,2000);
        $("#bigring").animate({ right: "850px" }, bigringSpeed, "linear", function () {
          $("#bigring").css("right", "-200px");
          setTimeout(bigringStart, 8000);
        });
      }

      //
      function getRandomNumber(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      //
      function CollodingCheck(el1, el2) {
        const rect1 = el1.getBoundingClientRect();
        const rect2 = el2.getBoundingClientRect();
        return !(
          rect1.bottom < rect2.top + 30 ||
          rect1.top > rect2.bottom - 30 ||
          rect1.right < rect2.left + 30 ||
          rect1.left > rect2.right - 30
        );
      }
        
      //
      function updateScore(score) {
        $("#score").text(score);
        $("#score2").text(score);
      }

      //
      function CollidingResult() {
        setInterval(function () {
          if (CollodingCheck($("#sonic")[0], $("#ring")[0])){
            score += 200;
            updateScore(score);
            $("#ring").stop();
            $("#ring").css("right", "-60px");
            ringStart();
          }
          if (CollodingCheck($("#sonic")[0], $("#bigring")[0])){
            score += 1000;
            updateScore(score);
            $("#bigring").stop();
            $("#bigring").css("right", "-200px");
            setTimeout(bigringStart, 8000);
          }
          if (CollodingCheck($("#sonic")[0], $("#bullet")[0])) {
            gokuchance--;
            $("#sonic").stop();
            $("#bullet").stop();
            $("#ring").stop();
            $("#bigring").stop();
            $("#attack").stop();
            $(".gameover").show();
          }
          if (CollodingCheck($("#dragonball")[0], $("#ring")[0])){
            score += 200;
            updateScore(score);
            $("#ring").stop();
            $("#ring").css("right", "-60px");
            ringStart();
          }
          if (CollodingCheck($("#dragonball")[0], $("#bigring")[0])){
            score += 1000;
            updateScore(score);
            $("#bigring").stop();
            $("#bigring").css("right", "-200px");
            setTimeout(bigringStart, 8000);
          }
          if (CollodingCheck($("#dragonball")[0], $("#bullet")[0])){
            score += 100;
            updateScore(score);
            $("#bullet").stop();
            $("#bullet").css("right", "90px");
            bulletStart();
          }
        }, 1000 / 60);
      }

      // 키보드 이벤트 정의
      let isJumpingSonic = false;
      let isAttack = false;
      function setKeyboardEvent() {
        $("html").keydown(function (e) {
          switch (e.key) {
            case " ":
              if (!isJumpingSonic) {
                sonicJump();
              }
              break;
            case "m":
              if(gokuchance===1){
                gokuchance--;
                $("#dragonballeffect").show();
                $("#bullet").hide();
                setTimeout(dragonballMoveRight, 2800);
                setTimeout(() => {
                  $("#bullet").show();
                }, 4100);
                break;
              }
            case "r":
              if(!isAttack) {
                attackMoveRight();
              }
              break;
          }
        });
      }

      //
      function sonicJump() {
        $("#sonic").attr("src", "../game/images/sonicjump.gif");
        isJumpingSonic = true;
        $("#sonic")
          .animate({ bottom: "+=110px" })
          .animate({ bottom: "-=110px" }, function () {
            isJumpingSonic = false;
          });
        setTimeout(() => {
          $("#sonic").attr("src", "../game/images/sonic.gif");
        }, 700);
      }

      //
      function firstGame() {
        $("#gamestart_screen").hide();
        gameStart();
      }

      //
      function newGame() {
        $("#gameover_screen").hide();
        location.reload();
      }
      
      
    </script>
  </head>

  <body>
    <img class="gamemargin" id="marginleft" src="../game/images/left.png" alt="" />
    <img class="gamemargin" id="marginright" src="../game/images/right.png" alt="" />
    <img class="gamemargin" id="margintop" src="../game/images/top.png" alt="" />
    <img class="gamemargin" id="marginbottom" src="../game/images/bottom.png" alt="" />

    <div id="container">

      <div id="gamestart_screen">
        <img id="gamestartdisplay" src="../game/images/gamestartdisplay.gif" alt="" />
        <img id="gamestartlogo" src="../game/images/soniclogo.png" alt=""/>
        <img id="gamestartbutton" src="../game/images/gamestartbutton.png" alt="" onclick="firstGame()" />
        <img id="gamestartclick" src="../game/images/clickmouse.gif" alt="" />
      </div>

      <div class="sliding-background" id="background1"></div>
      <div class="sliding-background" id="background2"></div>

      <div id="scoreboard">
        <img id="scoreboardled" src="../game/images/scoreboard2.png" alt="" />
        <div id="score">0</div>
      </div>

      <img id="sonic" src="../game/images/sonic.gif" alt="" />
      <img id="metalslug" src="../game/images/metalslug1.gif" alt="" />
      <img id="dragonball" src="../game/images/dragonball.gif" alt="" />
      <img id="dragonballeffect" src="../game/images/dragonballeffect.gif" alt="" />
      <img id="tank" src="../game/images/tank.gif" alt="">
      <img id="attack" src="../game/images/attack.gif" alt="">
      <img id="bullet" src="../game/images/bullet.png" alt="" />
      <img id="ring" src="../game/images/ring.gif" alt="" />
      <img id="bigring" src="../game/images/ring.gif" alt="">

      <div id="gameover_screen">
        <div class="gameover" id="gameoverbackground"></div>
        <img class="gameover" id="gameovertext" src="../game/images/gameover.gif" alt="" />
        <div class="gameover" id="score3">score</div>
        <div class="gameover" id="score2">0</div>
        <img class="gameover" id="newgame" src="../game/images/clicktocontinue.png" alt="" onclick="newGame()" />
        <img class="gameover" id="newgameclick" src="../game/images/clickmouse.gif" alt="" />
      </div>

    </div>

    <div id="infomation">
      <img id="inforing" src="../game/images/ring.gif" alt="" />
      <img id="infobullet" src="../game/images/bullet.png" alt="" />
    </div>
  </body>
</html>
